
from scipy.io import wavfile
import numpy as np

e = [ 1.,         -1.39633296,  0.46841189, -0.69600425,  1.17562901, -0.40912892,
  0.37339634, -1.02903467,  0.53459021,  0.011124,    0.03056732]
ll = [ 1.,         -2.31290523,  1.49606326, -0.15547028,  0.56006575, -0.79852425,
  0.16184324, -0.10320262,  0.2785704,  -0.10148356, -0.00666854]
oo = [ 1.,         -2.01650881,  1.00826265,  0.23934394,  0.07632905, -0.32807819,
  0.05059092, -0.16244381,  0.18058969,  0.02267418, -0.03044778]
u = [ 1.,         -2.55766909,  2.83532354, -2.20451397,  1.90039137, -2.00072789,
  2.11747837, -1.541302,    0.78850204, -0.47432413,  0.2108129 ]
rr = [ 1.,         -3.01250585,  4.18476758, -3.93516425,  3.25794138, -2.92736639,
  2.86889721, -2.50135287,  1.82227749, -1.0700554,   0.3402342 ]
null = np.zeros(11)


w1 = [ 1.,         -1.14681222,  0.31769281,  0.1569428,  -0.4126789,   0.14379403,
  0.27746388, -0.30259201, -0.03200752,  0.37169448, -0.19400562]
w2 = [ 1.,         -1.12622163,  0.34717413, -0.25155124,  0.10044428,  0.11911237,
 -0.09563588, -0.01456779,  0.01782322,  0.05663657, -0.03507301]
w3 = [ 1.,         -0.92402262, -0.04816147,  0.03877826, -0.00564691, -0.04435211,
  0.00194132,  0.08812784,  0.03337832, -0.05844053,  0.03675977]
w4 = [ 1.,         -1.00852675,  0.07654038, -0.05861248, -0.03180237,  0.09432886,
  0.02428998, -0.0903208,   0.04628637,  0.07322249, -0.01911564]
w5 = [ 1.,         -0.86527994, -0.10918381, -0.03591668,  0.08375507,  0.00483447,
 -0.06150678,  0.09566118, -0.00755628, -0.0219443,   0.04410111]
w6 = [ 1.00000000e+00, -3.80181221e-01, -3.74641993e-01,  3.38651765e-02,
  3.06661438e-02, -1.20223195e-01,  5.22950484e-02, -3.16887071e-02,
  7.62014193e-04, -2.23799078e-02, -2.37449234e-02,]
w7 = [ 1.,         -1.60582443,  1.45968445, -1.49146154,  1.5551607,  -1.25512501,
  0.8482294,  -0.62250537,  0.44557126, -0.18924445,  0.04717702]
w8 = [ 1.,         -1.18825404,  0.31363929, -0.02350845, -0.10270718,  0.26590322,
 -0.07826209, -0.15154116,  0.14050123, -0.04379686, -0.01750797]
w9 = [ 1.,         -0.89667601,  0.01891052, -0.00890245,  0.00288624,  0.05016033,
 -0.01895826,  0.01362466,  0.05227447,  0.00877606, -0.01207628]
w10 = [ 1.,         -0.99145441,  0.0566647,  -0.04375254, -0.00973217, -0.00113246,
  0.01484137,  0.0576821,   0.00644523,  0.01315505,  0.00364156]

WLEN = 50

hello = [(e, 200, 200), (ll, 1000, 200), (oo, 1000, 50), (u, 500, 500), (null, 1000, 1), (w1, 10, WLEN), (w2, 10, WLEN), (w3, 10, WLEN), (w4, 10, WLEN), (w5, 10, WLEN), (w6, 10, WLEN), (w7, 10, WLEN), (w8, 10, WLEN), (w9, 10, WLEN), (w10, 10, WLEN), (u, 500, 50), (rr, 1000, 500)]

count = 0

dsyn = []

delay = np.zeros(10)

taps = np.zeros(11)

for (phoneme, length, interp) in hello:

    taps_lerp = (np.array(phoneme) - taps) / interp
#    taps = phoneme

    for i in range(0, length + interp):

        if (i < interp):
            taps += taps_lerp
        
        pulse = 0

        if count == 37:
            pulse = 1.0
            count = 0
        
        count += 1
        
        if (taps[0] == 0.0):
            accu = 0
        else:
            accu = pulse

        for i, coeff in enumerate(taps[1:]):
            print("i: %d coeff: %f delay[i]: %f" % (i, coeff, delay[i]))
            accu -= coeff * delay[i]
        
        dsyn.append(accu)

        delay[1:] = delay[:-1]
        delay[0] = accu
        print (taps)
        print (delay)

dsyn = np.array(dsyn)
dsyn *= 32768 * 0.1

wavfile.write("hello?.wav", 6000, dsyn.astype(np.int16))
